#!/bin/bash
# Configure nginx to run as user nginx and listen on all IPs on port 8080

# Edit nginx.conf: change user to nginx
sed -i 's/^user .*/user nginx;/' /etc/nginx/nginx.conf

# Edit default site config or main config to listen on port 8080 on all IPs
# Assuming default server config is at /etc/nginx/conf.d/default.conf or /etc/nginx/sites-enabled/default
# Try both common paths and replace 'listen 80;' with 'listen 8080;'
if [ -f /etc/nginx/conf.d/default.conf ]; then
  sed -i 's/listen 80;/listen 8080;/' /etc/nginx/conf.d/default.conf
elif [ -f /etc/nginx/sites-enabled/default ]; then
  sed -i 's/listen 80;/listen 8080;/' /etc/nginx/sites-enabled/default
else
  # fallback: update all listen directives from 80 to 8080 in /etc/nginx/nginx.conf and included files
  find /etc/nginx -type f -name '*.conf' -exec sed -i 's/listen 80;/listen 8080;/' {} +
fi

# Reload nginx to apply changes
nginx -s reload

